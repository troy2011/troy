# 島占領・建設システム クイックスタートガイド

## 🚀 すぐに使い始める

### 前提条件

1. サーバーが起動していること
```bash
node server.js
```

2. ブラウザでアプリを開いていること（LIFF URL）

3. PlayFabとFirestoreに接続できること

---

## 📋 基本的な使い方（3ステップ）

### ステップ1: 島に接近する

1. 「地図」タブを開く
2. 船を動かして島に近づく
3. 島をクリック → 自動的に島の中心へ移動

### ステップ2: 建設メニューを開く

1. 島に接触したら、もう一度島をクリック
2. Bottom Sheetが表示される
3. 空きスロット（薄紫の「+」アイコン）をクリック

### ステップ3: 施設を建設する

1. カテゴリタブ（⚔️軍事、💰経済、🛠️補助）を選択
2. 施設リストから建設したい施設を選択
3. 「建設」ボタンをクリック
4. 建設開始！

---

## 🏗️ 建設中の表示

### マップ上
- **足場**: 🏗️ が上下にバウンス
- **クレーン**: 🏗️ が左右に回転
- **粉塵**: 小さな点が飛び散る
- **音**: トンテンカン（音声ファイル追加後）

### Bottom Sheet
- **スロット**: 黄色の背景
- **アイコン**: 🏗️
- **残り時間**: リアルタイム更新
- **ヘルプボタン**: 水色のボタン

---

## 👥 ヘルプ機能の使い方

### ヘルプを要請する

1. 建設中のスロットの「ヘルプ要請」ボタンをクリック
2. LINEグループを選択
3. 共有完了！

### ヘルプする

1. LINEで共有されたメッセージの「手伝う」ボタンをクリック
2. アプリが開く
3. 自動的にヘルプ完了！
4. 建設時間が5%短縮される（最大50%）

---

## 🎉 完成時の表示

### 完成通知モーダル
- 🚩 旗が下から上へ上昇
- ✨ スパークルが点滅
- 🎆 花火が爆発
- 「🎉 建設完了！」メッセージ

### マップ上
- 足場・クレーンが消える
- 建設音が停止
- 施設アイコンが表示される

---

## 🎮 施設一覧（13種類）

### ⚔️ 軍事施設（4種類）

| 施設 | スロット | 建設時間 | 効果 |
|------|----------|----------|------|
| 見張り台 | 1 | 30分 | 視界範囲+10、敵接近時通知 |
| 沿岸砲台 | 1 | 1時間 | 防衛力+30、攻撃範囲5グリッド |
| 要塞 | 2 | 3時間 | 防衛力+100、駐屯兵+50 |
| 造船所 | 4 | 6時間 | 船の建造が可能、同時建造3隻 |

### 💰 経済施設（5種類）

| 施設 | スロット | 建設時間 | 効果 |
|------|----------|----------|------|
| 倉庫 | 1 | 30分 | 保管容量+1000、略奪保護50% |
| 農園 | 1 | 1時間 | 食料生産+50/時、士気+10 |
| 交易所 | 2 | 2時間 | 交易収入+20%、交易ルート+2 |
| 鉱山 | 2 | 4時間 | 石材+30/時、鉄鉱+20/時、金貨+10/時 |
| 大市場 | 4 | 8時間 | 交易収入+50%、交易ルート+5 |

### 🛠️ 補助施設（4種類）

| 施設 | スロット | 建設時間 | 効果 |
|------|----------|----------|------|
| 酒場 | 1 | 20分 | 乗組員募集可能、士気+15 |
| 修理ドック | 2 | 2時間 | 修理速度2.0倍、コスト-30% |
| 灯台 | 1 | 1時間 | 航海速度+20%、視界+10グリッド |
| 神殿 | 4 | 6時間 | 全能力+10%、HP回復2.0倍 |

---

## 🗺️ 島のサイズとスロット

| サイズ | スロット数 | レイアウト | 建設可能数 |
|--------|------------|------------|------------|
| 小島 (small) | 1 | 1x1 | 1つ |
| 中島 (medium) | 2 | 1x2 | 2つ |
| 大島 (large) | 4 | 2x2 | 4つ |
| 首都 (giant) | 9 | 3x3 | 9つ |

---

## 🌍 バイオームボーナス

| バイオーム | カテゴリ | ボーナス | 説明 |
|------------|----------|----------|------|
| 🪨 岩山 (rocky) | 軍事 | +20% | 軍事施設の耐久度+20% |
| 🌲 森林 (forest) | 経済 | +20% | 経済施設の生産量+20% |
| 🏖️ 砂浜 (beach) | 補助 | -50% | 補助施設の建設時間-50% |
| 🌋 火山 (volcanic) | 軍事 | +30% | 防衛施設の攻撃力+30% |
| 🌴 ジャングル (jungle) | 経済 | +15% | 資源生産+15% |

**戦略ヒント**: 岩山に沿岸砲台を建てると防衛力が1.2倍！

---

## 🐉 守護獣（未実装）

| 守護獣 | HP | 攻撃 | 防御 | 難易度 |
|--------|-----|------|------|--------|
| 巨大カニ | 100 | 15 | 20 | 易 |
| スケルトン戦士 | 150 | 25 | 15 | 中 |
| 海蛇 | 200 | 30 | 25 | 難 |
| クラーケン | 300 | 40 | 30 | 最難 |

**注**: 守護獣戦闘システムは今後実装予定

---

## 🎵 建設音について

### 必要な音声ファイル

- `public/audio/construction.mp3`
- `public/audio/construction.ogg`

### 音声ファイルの入手方法

詳細は [public/audio/AUDIO_FILES_NEEDED.md](public/audio/AUDIO_FILES_NEEDED.md) を参照。

**推奨サイト**:
- 効果音ラボ: https://soundeffect-lab.info/
- 魔王魂: https://maou.audio/

**検索ワード**: 「トンカチ」「釘打ち」「工事」

---

## 🔧 トラブルシューティング

### Q: 建設メニューが表示されない

**A**: 以下を確認してください
1. 船が島に接触しているか
2. 自分が所有している島か（他人の島は表示されません）
3. コンソールにエラーが出ていないか

### Q: ヘルプ要請ボタンが押せない

**A**: LINEアプリ内で開いているか確認してください
- ブラウザで開いている場合は機能しません

### Q: 建設音が再生されない

**A**: 音声ファイルを追加してください
- [public/audio/AUDIO_FILES_NEEDED.md](public/audio/AUDIO_FILES_NEEDED.md)

### Q: マップに足場が表示されない

**A**: 以下を確認してください
1. 建設を開始したか
2. 30秒以上経過したか（自動更新は30秒ごと）
3. 地図タブを開いているか

---

## 📱 ブラウザのコンソールで使える便利コマンド

### 建設を開始（テスト用）
```javascript
await Island.startConstruction('yourPlayFabId', 'island_001', 'watchtower', 0);
```

### 建設メニューを表示
```javascript
const island = await Island.getIslandDetails('island_001');
Island.showBuildingMenu(island, 'yourPlayFabId');
```

### 建設音を再生
```javascript
Island.playConstructionSound(true);  // 再生
Island.playConstructionSound(false); // 停止
```

### 建設中の島を取得
```javascript
const response = await fetch('/api/get-constructing-islands', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({})
});
const data = await response.json();
console.log(data.islands);
```

---

## 📚 詳細ドキュメント

- **サーバー側**: [ISLAND_OCCUPATION_SYSTEM.md](ISLAND_OCCUPATION_SYSTEM.md)
- **クライアント側**: [ISLAND_UI_IMPLEMENTATION.md](ISLAND_UI_IMPLEMENTATION.md)
- **統合完了**: [ISLAND_SYSTEM_INTEGRATION_COMPLETE.md](ISLAND_SYSTEM_INTEGRATION_COMPLETE.md)
- **チェックリスト**: [INTEGRATION_CHECKLIST.md](INTEGRATION_CHECKLIST.md)

---

## 🎮 楽しい使い方

### 1. 海賊の拠点を作る
- 砂浜の島に酒場と修理ドックを建設
- 高速で船を修理して次の略奪へ！

### 2. 交易ハブを作る
- 森林の島に交易所と大市場を建設
- バイオームボーナス+20%で大儲け！

### 3. 難攻不落の要塞を作る
- 岩山の島に要塞と沿岸砲台を建設
- バイオームボーナス+20%で鉄壁の防御！

### 4. ギルドで協力建設
- 大きな施設（造船所、神殿）を建設
- メンバーにヘルプ要請して高速建設！
- 最大10人のヘルプで建設時間50%短縮！

---

## ✨ おわりに

島占領・建設システムへようこそ！

戦略的に施設を配置して、最強の海賊王国を築き上げましょう！🏴‍☠️

**質問や問題があれば、ドキュメントを参照するか、開発者に連絡してください。**

楽しいゲームライフを！⛵🏗️🎉

