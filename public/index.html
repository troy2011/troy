<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;700;900&display=swap" rel="stylesheet">
    <link rel="icon" href="data:,">

    <title>繝槭うLIFF繧｢繝励Μ (v55)</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="css/island.css">
</head>

<body>
    <div id="appWrapper" style="display: none;">
        <!-- 笘・繝倥ャ繝繝ｼ (Global Status) -->
        <div id="globalStatusBar">
            <div id="globalPlayerInfoTop">
                <div id="globalPlayerInfo">
                    <span style="color: var(--accent-color); font-size: 12px;">Lv.<b id="globalLevel">?</b></span>
                    <span id="globalPlayerName">Player</span>
                </div>
                <div class="currency-display">
                    <b id="globalPoints">?</b> Ps
                </div>
            </div>
            
            <!-- 繝舌・ -->
            <div class="global-status-bar-container">
                <span>HP</span>
                <div class="global-status-bar-bg">
                    <div id="globalHpBar" class="status-bar hp-bar"></div>
                </div>
                <b id="globalCurrentHP" style="font-size: 10px;">?</b><span style="width:auto; font-size:10px;">/</span><b id="globalMaxHP" style="font-size: 10px;">?</b>
            </div>
            <div class="global-status-bar-container">
                <span>MP</span>
                <div class="global-status-bar-bg">
                    <div id="globalMpBar" class="status-bar mp-bar"></div>
                </div>
                <b id="globalCurrentMP" style="font-size: 10px;">?</b><span style="width:auto; font-size:10px;">/</span><b id="globalMaxMP" style="font-size: 10px;">?</b>
            </div>
        </div>

        <div id="tabContainer">
            <!-- 1. 繝帙・繝繧ｿ繝・-->
            <div id="tabContentHome" class="tab-content">
                <!-- 繧｢繝舌ち繝ｼ繧ｫ繝ｼ繝・-->
                <div class="content-area" id="chatArea">
                    <div id="homeShipStage" class="home-ship-stage">
                        <img src="Sprites/Ships/homeShip.png" alt="Home Ship" class="home-ship-image">
                        <div id="home-avatar" class="home-ship-avatar avatar-container">
                            <div id="home-avatar-layer-body" class="avatar-layer"></div>
                            <div id="home-avatar-layer-head" class="avatar-layer"></div>
                            <div id="home-avatar-layer-hair" class="avatar-layer"></div>
                            <div id="home-avatar-layer-armor" class="avatar-layer"></div>
                            <div id="home-avatar-layer-hand-right" class="avatar-layer"></div>
                            <div id="home-avatar-layer-weapon-right" class="avatar-layer"></div>
                            <div id="home-avatar-layer-hand-left" class="avatar-layer"></div>
                            <div id="home-avatar-layer-shield-left" class="avatar-layer"></div>
                        </div>
                    </div>
                    <h2>繝√Ε繝・ヨ</h2>
                    <div id="chatMessages"></div>
                    <form id="chatInputArea" onsubmit="return false;">
                        <input type="text" id="chatInput" placeholder="繝｡繝・そ繝ｼ繧ｸ...">
                        <button id="btnSendChat">騾∽ｿ｡</button>
                    </form>
                </div>
            </div>

            <!-- 2. 蝨ｰ蝗ｳ繧ｿ繝・-->
            <div id="tabContentMap" class="tab-content" style="display: none;">
                <div id="phaser-container" style="width: 100%; height: calc(100vh - 140px); background: #000; touch-action: none;"></div>
                <div id="shipActionPanel" class="ship-action-panel">
                    <button id="shipActionButton" class="ship-action-button">Action</button>
                    <div id="shipActionStatus" class="ship-action-status"></div>
                </div>

                <!-- 蟲ｶ繧ｳ繝槭Φ繝峨ヱ繝阪Ν・井ｸ九°繧峨せ繝ｩ繧､繝峨う繝ｳ・・-->
                <div id="islandCommandPanel" class="island-command-panel">
                    <div class="island-command-header">
                        <div class="respawn-info">
                            <span class="respawn-label">蟲ｶ:</span>
                            <h3 id="islandCommandTitle">譛ｪ險ｭ螳・/h3>
                        </div>
                        <button id="islandCommandClose" class="island-command-close">ﾃ・/button>
                    </div>
                    <div class="island-command-buttons">
                        <button id="islandCommandAction" class="island-command-btn">蟒ｺ險ｭ繝｡繝九Η繝ｼ繧帝幕縺・/button>
                    </div>
                </div>
            </div>

            <!-- 3. 闊ｪ豬ｷ繧ｿ繝・-->
            <div id="tabContentVoyage" class="tab-content" style="display: none;">
                <div class="content-area">
                    <h2>闊ｪ豬ｷ繝溘ャ繧ｷ繝ｧ繝ｳ</h2>
                    <div id="voyageStatusArea">
                        <span id="voyageStatusText">・郁ｪｭ縺ｿ霎ｼ縺ｿ荳ｭ...・・/span>
                        <p id="voyageRewardText" style="color: var(--accent-color); margin-top:5px; font-weight:bold;"></p>
                    </div>
                    <div id="voyageMissionButtons">
                        <button id="btnStartVoyage10min">傷・・霑第ｵｷ縺ｮ蟆丞ｳｶ縺ｸ (10蛻・</button>
                        <button id="btnStartVoyage1hour">穴 蠏舌・豬ｷ蝓溘∈ (1譎る俣)</button>
                    </div>
                    <div style="margin-top:16px; display:flex; gap:10px;">
                        <button id="btnCheckVoyageStatus" style="flex:1;">迥ｶ豕∫｢ｺ隱・/ 蝣ｱ驟ｬ蜿怜叙</button>
                        <button id="btnReturnToPort" style="flex:1; display: none; background:var(--hp-color);">蟶ｰ貂ｯ縺吶ｋ</button>
                    </div>
                </div>
            </div>

            <!-- 4. 闊ｹ邂｡逅・ち繝・-->
            <div id="tabContentShips" class="tab-content" style="display: none;">
                <div class="content-area">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
                        <h2>菫晄怏闊ｹ闊ｶ</h2>
                        <button id="btnCreateShip" style="padding: 8px 16px; background: var(--accent-color); color: white; border: none; border-radius: 4px; cursor: pointer;">
                            圓 譁ｰ騾闊ｹ
                        </button>
                    </div>
                    <div id="playerShipsContainer">
                        <!-- 闊ｹ荳隕ｧ縺後％縺薙↓陦ｨ遉ｺ縺輔ｌ繧・-->
                        <div style="text-align: center; color: var(--text-sub); padding: 20px;">隱ｭ縺ｿ霎ｼ縺ｿ荳ｭ...</div>
                    </div>
                </div>
            </div>

            <!-- 5. 繧､繝ｳ繝吶Φ繝医Μ繧ｿ繝・-->
            
            <!-- 5. ???????? -->
            <div id="tabContentInventory" class="tab-content" style="display: none;">
    <!-- 装備 & ステータス -->
    <div class="content-area avatar-card">
        <div id="resourceSummary" class="resource-summary">
            <div class="resource-summary-title">資源</div>
            <div class="resource-summary-row" id="resourceSummaryRows"></div>
        </div>
        <div class="avatar-container" id="avatar">
            <div id="avatar-layer-body" class="avatar-layer"></div>
            <div id="avatar-layer-head" class="avatar-layer"></div>
            <div id="avatar-layer-hair" class="avatar-layer"></div>
            <div id="avatar-layer-armor" class="avatar-layer"></div>
            <div id="avatar-layer-hand-right" class="avatar-layer"></div>
            <div id="avatar-layer-weapon-right" class="avatar-layer"></div>
            <div id="avatar-layer-hand-left" class="avatar-layer"></div>
            <div id="avatar-layer-shield-left" class="avatar-layer"></div>
        </div>

        <!-- 装備スロット -->
        <div id="equipmentGrid">
            <div class="equip-slot weapon-slot" data-slot="rightHand" data-tooltip="右手の装備">
                <div class="equip-slot-icon">右</div>
                <div class="equip-slot-content">
                    <label class="equip-slot-label">右手</label>
                    <span id="equippedRightHand" class="equip-slot-name">未装備</span>
                    <div id="equippedRightHandStats" class="equip-slot-stats"></div>
                </div>
                <div class="equip-slot-glow"></div>
            </div>
            <div class="equip-slot shield-slot" data-slot="leftHand" data-tooltip="左手の装備">
                <div class="equip-slot-icon">左</div>
                <div class="equip-slot-content">
                    <label class="equip-slot-label">左手</label>
                    <span id="equippedLeftHand" class="equip-slot-name">未装備</span>
                    <div id="equippedLeftHandStats" class="equip-slot-stats"></div>
                </div>
                <div class="equip-slot-glow"></div>
            </div>
            <div class="equip-slot armor-slot" data-slot="armor" data-tooltip="防具">
                <div class="equip-slot-icon">防</div>
                <div class="equip-slot-content">
                    <label class="equip-slot-label">防具</label>
                    <span id="equippedArmor" class="equip-slot-name">未装備</span>
                    <div id="equippedArmorStats" class="equip-slot-stats"></div>
                </div>
                <div class="equip-slot-glow"></div>
            </div>
        </div>
    </div>

    <!-- ステータス -->
    <div class="content-area" id="playerStatsArea">
        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:10px;">
            <h2>ステータス</h2>
            <button id="btnGetStats" style="padding:6px 12px; font-size:12px;">更新</button>
        </div>
        <div class="stats-grid">
            <div class="stat-item">
                <span class="stat-label">筋力</span>
                <span class="stat-value-group">
                    <span class="stat-value" id="currentStr">?</span>
                    <span class="stat-bonus" id="currentStrBonus"></span>
                </span>
            </div>
            <div class="stat-item">
                <span class="stat-label">防御力</span>
                <span class="stat-value-group">
                    <span class="stat-value" id="currentDef">?</span>
                    <span class="stat-bonus" id="currentDefBonus"></span>
                </span>
            </div>
            <div class="stat-item">
                <span class="stat-label">敏捷</span>
                <span class="stat-value-group">
                    <span class="stat-value" id="currentAgi">?</span>
                    <span class="stat-bonus" id="currentAgiBonus"></span>
                </span>
            </div>
            <div class="stat-item">
                <span class="stat-label">知力</span>
                <span class="stat-value-group">
                    <span class="stat-value" id="currentInt">?</span>
                    <span class="stat-bonus" id="currentIntBonus"></span>
                </span>
            </div>
        </div>
    </div>

    <div class="content-area">
        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:10px;">
            <h2>アイテム</h2>
            <select id="inventorySort" style="background: #374151; color: #fff; border: none; padding: 4px; border-radius: 4px; font-size:12px;">
                <option value="default">入手順</option>
                <option value="power_desc">攻撃力順</option>
                <option value="defense_desc">防御力順</option>
            </select>
        </div>
        <p id="pointMessage" style="font-size:12px; color:var(--text-sub); margin: 4px 0 10px;"></p>

        <div id="inventoryTabs">
            <button class="inventory-tab-btn active" data-category="All">すべて</button>
            <button class="inventory-tab-btn" data-category="Weapon">武器</button>
            <button class="inventory-tab-btn" data-category="Shield">盾</button>
            <button class="inventory-tab-btn" data-category="Armor">防具</button>
            <button class="inventory-tab-btn" data-category="Consumable">道具</button>
        </div>

        <div id="inventoryGrid"></div>
        <!-- 従来のリスト（隠し、または予備） -->
        <ul id="inventoryList" style="display:none;"></ul>
    </div>
</div>
<!-- 5. QR/繝舌ヨ繝ｫ/繧ｮ繝ｫ繝峨ち繝・-->
            <div id="tabContentQr" class="tab-content" style="display: none;">
                <!-- QR繧ｳ繝ｼ繝芽｡ｨ遉ｺ繧ｨ繝ｪ繧｢ -->
                <div class="content-area">
                    <h2>QR繝舌ヨ繝ｫ & 騾・≡</h2>
                    <div id="myQrArea" style="text-align:center; margin:20px 0;">
                        <canvas id="myQrCanvas"></canvas>
                        <p style="font-size:12px; color:var(--text-sub);">縺薙・繧ｳ繝ｼ繝峨ｒ隱ｭ縺ｿ蜿悶▲縺ｦ蟇ｾ謌ｦ繝ｻ騾・≡</p>
                    </div>

                    <div style="display:grid; grid-template-columns: 1fr 1fr; gap:16px;">
                        <div id="battleArea">
                            <button id="btnScanBattle" style="width:100%; height:100%; display:flex; flex-direction:column; align-items:center; justify-content:center; gap:8px;">
                                <span style="font-size:24px;">笞費ｸ・/span>
                                蟇ｾ謌ｦ繧呈倦繧
                            </button>
                            <p id="battleResult" style="font-size:12px; text-align:center;"></p>
                        </div>
                        <div id="transferArea">
                             <div style="display:flex; align-items:center; gap:4px; margin-bottom:8px;">
                                <input type="number" id="transferAmount" placeholder="10" value="10" style="width:100%; padding:8px; border-radius:4px; border:1px solid var(--border-color); background:#374151; color:#fff;">
                                <span>Ps</span>
                             </div>
                            <button id="btnScanPay" style="width:100%;">騾・≡縺吶ｋ</button>
                        </div>
                    </div>
                </div>

                <!-- 繧ｮ繝ｫ繝画ｩ溯・繧ｨ繝ｪ繧｢ -->
                <div class="content-area">
                    <h2>繧ｮ繝ｫ繝・/h2>

                    <!-- 繧ｮ繝ｫ繝画悴蜉蜈･譎ゅ・陦ｨ遉ｺ -->
                    <div id="guildNotJoined" style="display: none;">
                        <p style="text-align: center; color: var(--text-sub); margin: 20px 0;">繧ｮ繝ｫ繝峨↓蜉蜈･縺励※縺・∪縺帙ｓ</p>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px;">
                            <button id="btnCreateGuild" style="display:flex; flex-direction:column; align-items:center; justify-content:center; gap:8px; padding: 20px;">
                                <span style="font-size:24px;">抄窶坂丐・・/span>
                                繧ｮ繝ｫ繝我ｽ懈・
                            </button>
                            <button id="btnScanJoinGuild" style="display:flex; flex-direction:column; align-items:center; justify-content:center; gap:8px; padding: 20px;">
                                <span style="font-size:24px;">導</span>
                                QR縺ｧ蜉蜈･
                            </button>
                        </div>
                    </div>

                    <!-- 繧ｮ繝ｫ繝牙刈蜈･貂医∩譎ゅ・陦ｨ遉ｺ -->
                    <div id="guildJoined" style="display: none;">
                        <div style="background: rgba(0,0,0,0.2); padding: 16px; border-radius: 8px; margin-bottom: 16px;">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
                                <h3 id="guildName" style="margin: 0; color: var(--accent-color);">繧ｮ繝ｫ繝牙錐</h3>
                                <span id="guildRole" style="font-size: 12px; color: var(--text-sub);">繝｡繝ｳ繝舌・</span>
                            </div>
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px; font-size: 14px; margin-bottom: 12px;">
                                <div>
                                    <span style="color: var(--text-sub);">繝｡繝ｳ繝舌・:</span>
                                    <span id="guildMemberCount" style="color: var(--text-main); font-weight: bold;">0</span>
                                    <span style="color: var(--text-sub);">/</span>
                                    <span id="guildMaxMembers" style="color: var(--text-sub);">10</span>
                                </div>
                                <div>
                                    <span style="color: var(--text-sub);">繝ｬ繝吶Ν:</span>
                                    <span id="guildLevel" style="color: var(--accent-color); font-weight: bold;">1</span>
                                </div>
                                <div>
                                    <span style="color: var(--text-sub);">雉・≡:</span>
                                    <span id="guildTreasury" style="color: var(--hp-color); font-weight: bold;">0</span>
                                    <span style="color: var(--text-sub);"> Ps</span>
                                </div>
                                <div id="guildPendingApplicationsDiv" style="display: none;">
                                    <span style="color: var(--text-sub);">逕ｳ隲・</span>
                                    <span id="guildPendingApplications" style="color: var(--accent-color); font-weight: bold;">0</span>
                                    <span style="color: var(--text-sub);"> 莉ｶ</span>
                                </div>
                            </div>

                            <!-- 邨碁ｨ灘､繝舌・ -->
                            <div style="margin-top: 8px;">
                                <div style="display: flex; justify-content: space-between; font-size: 12px; color: var(--text-sub); margin-bottom: 4px;">
                                    <span>EXP</span>
                                    <span><span id="guildExpProgress">0</span> / <span id="guildExpRequired">100</span></span>
                                </div>
                                <div style="background: rgba(0,0,0,0.3); height: 8px; border-radius: 4px; overflow: hidden;">
                                    <div id="guildExpBar" style="background: linear-gradient(90deg, var(--accent-color), var(--hp-color)); height: 100%; width: 0%; transition: width 0.5s;"></div>
                                </div>
                            </div>
                        </div>

                        <!-- 繧ｮ繝ｫ繝画魚蠕・R繧ｳ繝ｼ繝・-->
                        <div style="text-align: center; margin: 20px 0;">
                            <p style="font-size: 14px; color: var(--text-sub); margin-bottom: 10px;">繧ｮ繝ｫ繝画魚蠕・R繧ｳ繝ｼ繝・/p>
                            <canvas id="guildQrCanvas" style="margin: 0 auto;"></canvas>
                        </div>

                        <!-- 繧ｮ繝ｫ繝峨い繧ｯ繧ｷ繝ｧ繝ｳ -->
                        <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; margin-top: 16px;">
                            <button id="btnViewGuildMembers">則 繝｡繝ｳ繝舌・</button>
                            <button id="btnViewGuildChat">町 繝√Ε繝・ヨ</button>
                            <button id="btnViewGuildWarehouse">逃 蛟牙ｺｫ</button>
                            <button id="btnViewGuildApplications" style="display: none;">搭 逕ｳ隲狗ｮ｡逅・/button>
                            <button id="btnLeaveGuild" style="background: var(--danger-color); grid-column: span 2;">閼ｱ騾</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 6. 繝ｩ繝ｳ繧ｭ繝ｳ繧ｰ繧ｿ繝・-->
            <div id="tabContentRanking" class="tab-content" style="display: none;">
                <div class="content-area">
                    <h2>繝ｩ繝ｳ繧ｭ繝ｳ繧ｰ</h2>
                    <div id="rankingToggleButtons">
                        <button id="btnShowPsRanking" class="ranking-toggle-btn active">Ps鬆・/button>
                        <button id="btnShowBountyRanking" class="ranking-toggle-btn">諛ｸ雉樣≡鬆・/button>
                    </div>

                    <!-- 笘・・笘・菫ｮ豁｣邂・園: psRankingArea 繧定ｿｽ蜉縺励∵峩譁ｰ繝懊ち繝ｳ縺ｨ繝ｪ繧ｹ繝医ｒ繝ｩ繝・・縺吶ｋ 笘・・笘・-->
                    <div id="psRankingArea">
                        <div style="text-align:right; margin-bottom:10px;">
                            <button id="btnGetRanking" style="font-size:12px; padding:4px 10px;">譖ｴ譁ｰ</button>
                        </div>
                        <ol id="rankingList"></ol>
                    </div>
                    
                    <!-- 笘・・笘・菫ｮ豁｣邂・園: bountyRankingArea 繧定ｿｽ蜉 笘・・笘・-->
                    <div id="bountyRankingArea" style="display: none;">
                        <ol id="bountyRankingList"></ol>
                    </div>
                </div>
            </div>

            <!-- 7. 邇九・繝ｼ繧ｸ・亥推蝗ｽ繧ｰ繝ｫ繝ｼ繝励・邇九・縺ｿ陦ｨ遉ｺ・・-->
            <div id="tabContentKing" class="tab-content" style="display: none;">
                <div class="content-area">
                    <h2>邇九・繝壹・繧ｸ</h2>
                    <p style="font-size:12px; color:var(--text-sub);">縺薙・繝壹・繧ｸ縺ｯ蜷・嵜・亥ｳｶ・峨げ繝ｫ繝ｼ繝励・邇九□縺代′髢ｲ隕ｧ縺ｧ縺阪∪縺吶・/p>

                    <div style="background: rgba(0,0,0,0.25); padding: 12px; border-radius: 8px; margin-top: 12px;">
                        <div style="display:flex; justify-content:space-between; gap:12px; align-items:center;">
                            <div>
                                <div style="font-size: 12px; color: var(--text-sub); margin-bottom: 4px;">遞守紫・・・・/div>
                                <input id="kingTaxRateInput" type="number" min="0" max="50" step="0.1" style="width: 140px; padding: 10px; border-radius: 6px; border: 1px solid var(--border-color); background: #111827; color: #fff; font-size: 14px;" />
                            </div>
                            <div style="flex:1;"></div>
                            <div style="display:flex; gap:10px; align-items:flex-end;">
                                <button id="btnKingSetTaxRate" style="background: var(--accent-color);">遞守紫繧剃ｿ晏ｭ・/button>
                                <button id="btnKingReload" style="background: #4b5563;">蜀崎ｪｭ縺ｿ霎ｼ縺ｿ</button>
                            </div>
                        </div>
                        <div style="margin-top: 8px; font-size: 11px; color: var(--text-sub);">遞守紫縺ｯ縲御ｻ倅ｸ守ｷ城｡阪阪°繧牙ｷｮ縺怜ｼ輔°繧後∫ｨ朱≡縺ｯ蝗ｽ蠎ｫ縺ｨ縺励※險倬鹸縺輔ｌ縺ｾ縺吶・/div>
                        <div id="kingTreasuryInfo" style="margin-top: 8px; font-size: 12px; color: var(--text-sub);"></div>
                    </div>

                    <div style="background: rgba(0,0,0,0.25); padding: 12px; border-radius: 8px; margin-top: 12px;">
                        <div style="font-size: 12px; color: var(--text-sub); margin-bottom: 8px;">Ps 莉倅ｸ趣ｼ・R繧ｳ繝ｼ繝会ｼ・/div>
                        <div style="display:grid; grid-template-columns: 1fr 1fr; gap:10px;">
                            <div>
                                <div style="font-size: 12px; color: var(--text-sub); margin-bottom: 4px;">蜿怜叙莠ｺ PlayFabId</div>
                                <input id="kingGrantReceiverId" type="text" placeholder="QR縺ｧ隱ｭ縺ｿ蜿悶ｊ or 謇句・蜉・ style="width: 100%; padding: 10px; border-radius: 6px; border: 1px solid var(--border-color); background: #111827; color: #fff; font-size: 14px;" />
                                <div style="display:flex; gap:10px; margin-top: 8px;">
                                    <button id="btnKingScanReceiver" style="background: #374151;">QR縺ｧ隱ｭ縺ｿ蜿悶ｊ</button>
                                    <button id="btnKingClearReceiver" style="background: #4b5563;">繧ｯ繝ｪ繧｢</button>
                                </div>
                            </div>
                            <div>
                                <div style="font-size: 12px; color: var(--text-sub); margin-bottom: 4px;">莉倅ｸ守ｷ城｡搾ｼ育視縺梧髪謇輔≧・・/div>
                                <input id="kingGrantAmount" type="number" min="1" step="1" placeholder="萓・ 100" style="width: 100%; padding: 10px; border-radius: 6px; border: 1px solid var(--border-color); background: #111827; color: #fff; font-size: 14px;" />
                                <div style="display:flex; gap:10px; margin-top: 8px;">
                                    <button id="btnKingGrantPs" style="background: var(--hp-color);">莉倅ｸ弱☆繧・/button>
                                </div>
                            </div>
                        </div>
                        <div id="kingGrantPreview" style="margin-top: 10px; font-size: 12px; color: var(--text-sub);"></div>
                    </div>

                    <div style="background: rgba(0,0,0,0.25); padding: 12px; border-radius: 8px; margin-top: 12px;">
                        <div style="font-size: 12px; color: var(--text-sub); margin-bottom: 8px;">邇九・隴ｲ貂｡・・R繧ｳ繝ｼ繝会ｼ・/div>
                        <div>
                            <div style="font-size: 12px; color: var(--text-sub); margin-bottom: 4px;">谺｡縺ｮ邇具ｼ・layFabId・・/div>
                            <input id="kingTransferTargetId" type="text" placeholder="QR縺ｧ隱ｭ縺ｿ蜿悶ｊ or 謇句・蜉・ style="width: 100%; padding: 10px; border-radius: 6px; border: 1px solid var(--border-color); background: #111827; color: #fff; font-size: 14px;" />
                            <div style="display:flex; gap:10px; margin-top: 8px;">
                                <button id="btnKingScanTransferTarget" style="background: #374151;">QR縺ｧ隱ｭ縺ｿ蜿悶ｊ</button>
                                <button id="btnKingTransfer" style="background: var(--danger-color);">邇九ｒ隴ｲ貂｡</button>
                            </div>
                            <div style="margin-top: 8px; font-size: 11px; color: var(--text-sub);">隴ｲ貂｡蠕後・縺薙・繝壹・繧ｸ縺ｫ繧｢繧ｯ繧ｻ繧ｹ縺ｧ縺阪↑縺上↑繧翫∪縺吶・/div>
                        </div>
                    </div>

                    <div style="background: rgba(0,0,0,0.25); padding: 12px; border-radius: 8px; margin-top: 12px;">
                        <div style="font-size: 12px; color: var(--text-sub); margin-bottom: 6px;">迴ｾ蝨ｨ縺ｮ蜻顔衍</div>
                        <div id="kingAnnouncementCurrent" style="white-space: pre-wrap; font-size: 14px;">-</div>
                        <div id="kingAnnouncementMeta" style="margin-top: 6px; font-size: 11px; color: var(--text-sub);"></div>
                    </div>

                    <div style="margin-top: 14px;">
                        <div style="font-size: 12px; color: var(--text-sub); margin-bottom: 6px;">譁ｰ縺励＞蜻顔衍・・00譁・ｭ励∪縺ｧ・・/div>
                        <textarea id="kingAnnouncementInput" maxlength="200" rows="4" style="width: 100%; padding: 10px; border-radius: 6px; border: 1px solid var(--border-color); background: #111827; color: #fff; font-size: 14px; resize: vertical;"></textarea>
                        <div style="display:flex; gap:10px; margin-top: 10px;">
                            <button id="btnKingSaveAnnouncement" style="background: var(--hp-color);">蜻顔衍繧呈峩譁ｰ</button>
                            <button id="btnKingReload2" style="background: #4b5563;">蜀崎ｪｭ縺ｿ霎ｼ縺ｿ</button>
                        </div>
                        <div id="kingPageMessage" style="margin-top: 10px; font-size: 12px; color: var(--accent-color);"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 繝翫ン繧ｲ繝ｼ繧ｷ繝ｧ繝ｳ -->
    <nav id="bottomNav">
        <button id="navHome" class="nav-button active" onclick="showTab('home')">
            <span class="nav-icon">匠</span><span>繝帙・繝</span>
        </button>
        <button id="navVoyage" class="nav-button" onclick="showTab('voyage')">
            <span class="nav-icon">笵ｵ</span><span>闊ｪ豬ｷ</span>
        </button>
        <button id="navShips" class="nav-button" onclick="showTab('ships')">
            <span class="nav-icon">圓</span><span>闊ｹ</span>
        </button>
        <button id="navMap" class="nav-button" onclick="showTab('map')">
            <span class="nav-icon">亮・・/span><span>蝨ｰ蝗ｳ</span>
        </button>
        <button id="navInventory" class="nav-button" onclick="showTab('inventory')">
            <span class="nav-icon">賜</span><span>謖√■迚ｩ</span>
        </button>
        <button id="navQr" class="nav-button" onclick="showTab('qr')">
            <span class="nav-icon">笞費ｸ・/span><span>莠､豬・/span>
        </button>
        <button id="navRanking" class="nav-button" onclick="showTab('ranking')">
            <span class="nav-icon">醇</span><span>鬆・ｽ・/span>
        </button>
        <button id="navKing" class="nav-button" onclick="showTab('king')" style="display:none;">
            <span class="nav-icon">荘</span><span>邇・/span>
        </button>
    </nav>

    <!-- 繧｢繧､繝・Β隧ｳ邏ｰ繝｢繝ｼ繝繝ｫ -->
    <div id="itemDetailModal" class="modal-overlay">
        <div class="modal-content">
            <div style="display: flex; align-items: center; margin-bottom: 15px;">
                <div id="itemDetailIcon" style="width: 64px; height: 64px; margin-right: 15px; background-color: rgba(0,0,0,0.3); border-radius: 8px; image-rendering: pixelated; transform: scale(1.5); transform-origin: center;"></div>
                <div style="text-align: left; flex:1;">
                    <h3 id="itemDetailName" style="margin: 0; color: var(--accent-color);">繧｢繧､繝・Β蜷・/h3>
                    <p id="itemDetailCategory" style="margin: 4px 0 0; font-size: 12px; color: var(--text-sub);">繧ｫ繝・ざ繝ｪ</p>
                </div>
            </div>
            <p id="itemDetailDescription" style="text-align: left; background:rgba(0,0,0,0.2); padding:10px; border-radius:8px; font-size:14px; margin-bottom:15px;">隱ｬ譏取枚...</p>
            <div id="itemDetailStats" style="text-align: left; margin-bottom: 20px; font-weight:bold;">
                <!-- 繧ｹ繝・・繧ｿ繧ｹ -->
            </div>
            <div id="itemDetailButtons" class="modal-buttons">
                <!-- 繧｢繧ｯ繧ｷ繝ｧ繝ｳ繝懊ち繝ｳ -->
            </div>
            <button onclick="document.getElementById('itemDetailModal').style.display='none'" style="margin-top: 15px; background: #4b5563; width:100%;">髢峨§繧・/button>
        </div>
    </div>

    <!-- 繝舌ヨ繝ｫ繝｢繝ｼ繝繝ｫ -->
    <div id="battleModal" class="modal-overlay">
        <div class="modal-content" style="background: rgba(17, 24, 39, 0.95);">
            <div id="battleStage">
                <!-- 逶ｸ謇・-->
                <div class="battle-player-area" id="battlePlayerA">
                    <div style="background:rgba(255,0,0,0.1); padding:4px; border-radius:4px; width:100%; text-align:center; border:1px solid #ef4444;">
                        <div id="battlePlayerAName" style="font-size:12px; overflow:hidden; text-overflow:ellipsis;">Enemy</div>
                        <div style="height:6px; background:#374151; margin-top:2px; border-radius:3px;">
                            <div id="battlePlayerAHpBar" style="height:100%; width:100%; background:#ef4444; transition:width 0.3s;"></div>
                        </div>
                        <div id="battlePlayerAHpText" style="font-size:10px;">-/-</div>
                    </div>
                    <div id="battle-avatar-A" class="battle-avatar-container">
                        <div id="battle-avatar-A-layer-body" class="avatar-layer"></div>
                        <div id="battle-avatar-A-layer-head" class="avatar-layer"></div>
                        <div id="battle-avatar-A-layer-hair" class="avatar-layer"></div>
                        <div id="battle-avatar-A-layer-armor" class="avatar-layer"></div>
                        <div id="battle-avatar-A-layer-hand-right" class="avatar-layer"></div>
                        <div id="battle-avatar-A-layer-weapon-right" class="avatar-layer"></div>
                        <div id="battle-avatar-A-layer-hand-left" class="avatar-layer"></div>
                        <div id="battle-avatar-A-layer-shield-left" class="avatar-layer"></div>
                    </div>
                    <div style="height:4px; width:100%; background:#374151; margin-top:5px; border-radius:2px;">
                         <!-- 謨ｵ縺ｮATB縺ｯ髱櫁｡ｨ遉ｺ縺ｧ繧ゅｈ縺・′縲∬｡ｨ遉ｺ縺吶ｋ縺ｪ繧峨％縺・-->
                         <div id="battlePlayerAAtbBar" style="height:100%; width:0%; background:var(--accent-color);"></div>
                    </div>
                </div>

                <!-- 閾ｪ蛻・-->
                <div class="battle-player-area" id="battlePlayerB">
                    <div style="background:rgba(0,255,0,0.1); padding:4px; border-radius:4px; width:100%; text-align:center; border:1px solid #10b981;">
                        <div id="battlePlayerBName" style="font-size:12px; overflow:hidden; text-overflow:ellipsis;">You</div>
                        <div style="height:6px; background:#374151; margin-top:2px; border-radius:3px;">
                            <div id="battlePlayerBHpBar" style="height:100%; width:100%; background:#10b981; transition:width 0.3s;"></div>
                        </div>
                         <div id="battlePlayerBHpText" style="font-size:10px;">-/-</div>
                    </div>
                    <div id="battle-avatar-B" class="battle-avatar-container">
                        <div id="battle-avatar-B-layer-body" class="avatar-layer"></div>
                        <div id="battle-avatar-B-layer-head" class="avatar-layer"></div>
                        <div id="battle-avatar-B-layer-hair" class="avatar-layer"></div>
                        <div id="battle-avatar-B-layer-armor" class="avatar-layer"></div>
                        <div id="battle-avatar-B-layer-hand-right" class="avatar-layer"></div>
                        <div id="battle-avatar-B-layer-weapon-right" class="avatar-layer"></div>
                        <div id="battle-avatar-B-layer-hand-left" class="avatar-layer"></div>
                        <div id="battle-avatar-B-layer-shield-left" class="avatar-layer"></div>
                    </div>
                    <!-- 閾ｪ蛻・・ATB -->
                     <div style="height:8px; width:100%; background:#374151; margin-top:5px; border-radius:4px; overflow:hidden; border:1px solid #d97706;">
                         <div id="battlePlayerBAtbBar" style="height:100%; width:0%; background:var(--accent-color); transition:width 0.1s linear;"></div>
                    </div>
                </div>
            </div>

            <div id="battleLogContainer" style="font-size:12px; color:#ccc;"></div>
            <div id="battleCommandArea" style="min-height:50px; display:flex; align-items:center; justify-content:center;">
                <p style="color:#6b7280; font-size:12px;">貅門ｙ荳ｭ...</p>
            </div>
        </div>
    </div>

    <!-- 縺昴・莉悶Δ繝ｼ繝繝ｫ -->
    <div id="loadingSpinner" class="modal-overlay">
        <div class="spinner"></div>
    </div>
    
    <div id="confirmationModal" class="modal-overlay">
        <div class="modal-content">
            <div style="font-size:40px;">腸</div>
            <h3>騾・≡遒ｺ隱・/h3>
            <div id="modalAmount" style="font-size:24px; color:var(--accent-color); margin:10px 0;">? Ps</div>
            <p>螳帛・: <span id="modalReceiverId">...</span></p>
            <div class="modal-buttons">
                <button id="btnConfirmTransfer" style="background:var(--hp-color);">騾√ｋ</button>
                <button id="btnCancelTransfer" style="background:#4b5563;">繧ｭ繝｣繝ｳ繧ｻ繝ｫ</button>
            </div>
        </div>
    </div>
    
    <div id="sellConfirmationModal" class="modal-overlay">
        <div class="modal-content">
            <h3>螢ｲ蜊ｴ遒ｺ隱・/h3>
            <p><strong id="sellItemName" style="color:#fff;">...</strong></p>
            <p>螢ｲ蜊ｴ鬘・ <span id="sellItemPrice" style="color:var(--accent-color); font-size:20px; font-weight:bold;">?</span> Ps</p>
            <div class="modal-buttons">
                <button id="btnConfirmSell" style="background:var(--danger-color);">螢ｲ繧・/button>
                <button id="btnCancelSell">繧・ａ繧・/button>
            </div>
        </div>
    </div>

    <div id="raceModal" class="modal-overlay">
        <div class="modal-content">
            <h2>遞ｮ譌城∈謚・/h2>
            <p style="font-size:12px; color:var(--text-sub);">荳蠎ｦ驕ｸ縺ｶ縺ｨ螟画峩縺ｧ縺阪∪縺帙ｓ</p>
            <div style="display:grid; grid-template-columns:1fr 1fr; gap:10px; margin-top:20px;" id="raceButtons">
                <button data-race="Human">繝偵Η繝ｼ繝槭Φ</button>
                <button data-race="Goblin">繧ｴ繝悶Μ繝ｳ</button>
                <button data-race="Elf">繧ｨ繝ｫ繝・/button>
                <button data-race="Orc">繧ｪ繝ｼ繧ｯ</button>
            </div>
            <p id="raceMessage" style="margin-top:10px; color:var(--accent-color);"></p>
        </div>
    </div>

    <!-- 繧ｮ繝ｫ繝我ｽ懈・繝｢繝ｼ繝繝ｫ -->
    <div id="guildCreateModal" class="modal-overlay">
        <div class="modal-content">
            <h2>繧ｮ繝ｫ繝我ｽ懈・</h2>
            <div style="margin: 20px 0;">
                <label style="display: block; margin-bottom: 8px; color: var(--text-sub);">繧ｮ繝ｫ繝牙錐</label>
                <input type="text" id="guildNameInput" placeholder="繧ｮ繝ｫ繝牙錐繧貞・蜉・ maxlength="30" style="width: 100%; padding: 12px; border-radius: 4px; border: 1px solid var(--border-color); background: #374151; color: #fff; font-size: 16px;">
            </div>
            <p id="guildCreateMessage" style="color: var(--accent-color); min-height: 20px;"></p>
            <div class="modal-buttons">
                <button id="btnConfirmCreateGuild" style="background: var(--hp-color);">菴懈・</button>
                <button id="btnCancelCreateGuild" style="background: #4b5563;">繧ｭ繝｣繝ｳ繧ｻ繝ｫ</button>
            </div>
        </div>
    </div>

    <!-- 繧ｮ繝ｫ繝峨Γ繝ｳ繝舌・荳隕ｧ繝｢繝ｼ繝繝ｫ -->
    <div id="guildMembersModal" class="modal-overlay">
        <div class="modal-content" style="max-height: 80vh; overflow-y: auto;">
            <h2>繧ｮ繝ｫ繝峨Γ繝ｳ繝舌・</h2>
            <div id="guildMembersList" style="margin: 20px 0;">
                <!-- 繝｡繝ｳ繝舌・繝ｪ繧ｹ繝医′縺薙％縺ｫ蜍慕噪縺ｫ陦ｨ遉ｺ縺輔ｌ繧・-->
            </div>
            <button onclick="document.getElementById('guildMembersModal').style.display='none'" style="width: 100%; background: #4b5563;">髢峨§繧・/button>
        </div>
    </div>

    <!-- 繧ｮ繝ｫ繝峨メ繝｣繝・ヨ繝｢繝ｼ繝繝ｫ -->
    <div id="guildChatModal" class="modal-overlay">
        <div class="modal-content" style="max-height: 80vh; display: flex; flex-direction: column;">
            <h2>繧ｮ繝ｫ繝峨メ繝｣繝・ヨ</h2>
            <div id="guildChatMessages" style="flex: 1; overflow-y: auto; background: rgba(0,0,0,0.2); padding: 12px; border-radius: 8px; margin: 12px 0; min-height: 300px; max-height: 400px;">
                <!-- 繝√Ε繝・ヨ繝｡繝・そ繝ｼ繧ｸ縺後％縺薙↓蜍慕噪縺ｫ陦ｨ遉ｺ縺輔ｌ繧・-->
            </div>
            <div style="display: flex; gap: 8px; margin-top: 8px;">
                <input type="text" id="guildChatInput" placeholder="繝｡繝・そ繝ｼ繧ｸ繧貞・蜉・.." maxlength="500" style="flex: 1; padding: 12px; border-radius: 4px; border: 1px solid var(--border-color); background: #374151; color: #fff;">
                <button id="btnSendGuildChat" style="padding: 12px 24px;">騾∽ｿ｡</button>
            </div>
            <button onclick="document.getElementById('guildChatModal').style.display='none'" style="width: 100%; background: #4b5563; margin-top: 12px;">髢峨§繧・/button>
        </div>
    </div>

    <!-- 繧ｮ繝ｫ繝牙牙ｺｫ繝｢繝ｼ繝繝ｫ -->
    <div id="guildWarehouseModal" class="modal-overlay">
        <div class="modal-content" style="max-height: 80vh; overflow-y: auto;">
            <h2>繧ｮ繝ｫ繝牙牙ｺｫ</h2>
            <div style="background: rgba(0,0,0,0.2); padding: 12px; border-radius: 8px; margin: 12px 0;">
                <span style="color: var(--text-sub);">繧ｮ繝ｫ繝芽ｳ・≡:</span>
                <span id="warehouseTreasury" style="color: var(--hp-color); font-weight: bold; font-size: 18px;">0</span>
                <span style="color: var(--text-sub);"> Ps</span>
            </div>
            <div id="guildWarehouseList" style="margin: 20px 0;">
                <!-- 蛟牙ｺｫ繧｢繧､繝・Β縺後％縺薙↓蜍慕噪縺ｫ陦ｨ遉ｺ縺輔ｌ繧・-->
            </div>
            <button onclick="document.getElementById('guildWarehouseModal').style.display='none'" style="width: 100%; background: #4b5563;">髢峨§繧・/button>
        </div>
    </div>

    <!-- 繧ｮ繝ｫ繝牙刈蜈･逕ｳ隲狗ｮ｡逅・Δ繝ｼ繝繝ｫ -->
    <div id="guildApplicationsModal" class="modal-overlay">
        <div class="modal-content" style="max-height: 80vh; overflow-y: auto;">
            <h2>蜉蜈･逕ｳ隲狗ｮ｡逅・/h2>
            <div id="guildApplicationsList" style="margin: 20px 0;">
                <!-- 蜉蜈･逕ｳ隲九Μ繧ｹ繝医′縺薙％縺ｫ蜍慕噪縺ｫ陦ｨ遉ｺ縺輔ｌ繧・-->
            </div>
            <button onclick="document.getElementById('guildApplicationsModal').style.display='none'" style="width: 100%; background: #4b5563;">髢峨§繧・/button>
        </div>
    </div>

    <!-- 繝ｩ繧､繝悶Λ繝ｪ (Firebase v9 Modular SDK 縺ｫ螟画峩) -->
    <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrious/4.0.2/qrious.min.js"></script>
    <script src="https://download.playfab.com/PlayFabClientApi.js"></script>
    <script src="https://download.playfab.com/PlayFabGroupsApi.js"></script>

    <!-- importmap 繧剃ｽｿ逕ｨ縺励※Firebase繝｢繧ｸ繝･繝ｼ繝ｫ繧貞ｮ夂ｾｩ -->
    <script type="importmap">
    {
      "imports": {
        "phaser": "./js/vendor/phaser.esm.js",
        "geofire-common": "/vendor/geofire-common/index.esm.js",
        "firebase/app": "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js",
        "firebase/auth": "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js",
        "firebase/database": "https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js",
        "firebase/firestore": "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js",
        "config": "./js/config.js",
        "api": "./js/api.js",
        "ui": "./js/ui.js",
        "avatar": "./js/avatar.js",
        "player": "./js/player.js",
        "inventory": "./js/inventory.js",
        "voyage": "./js/voyage.js",
        "game": "./Game.js"
      }
    }
    </script>

    <!-- 闊ｹ菴懈・繝｢繝ｼ繝繝ｫ -->
    <div id="shipCreateModal" class="modal-overlay">
        <div class="modal-content">
            <h2>譁ｰ縺励＞闊ｹ繧貞ｻｺ騾</h2>
            <div style="margin: 20px 0;">
                <label style="display: block; margin-bottom: 8px; color: var(--text-sub);">闊ｹ遞ｮ繧帝∈謚・</label>
                <select id="shipTypeSelect" style="width: 100%; padding: 10px; border-radius: 4px; background: var(--card-bg); color: var(--text-color); border: 1px solid var(--border-color);">
                    <option value="Sloop">繧ｹ繝ｫ繝ｼ繝・(蟆丞梛繝ｻ鬮倬・ - 1000 Ps</option>
                    <option value="Brigantine">繝悶Μ繧ｬ繝ｳ繝・ぅ繝ｳ (荳ｭ蝙九・繝舌Λ繝ｳ繧ｹ) - 3000 Ps</option>
                    <option value="Galleon">繧ｬ繝ｬ繧ｪ繝ｳ (螟ｧ蝙九・螟ｧ螳ｹ驥・ - 10000 Ps</option>
                </select>
            </div>
            <div style="background: rgba(0,0,0,0.3); padding: 12px; border-radius: 4px; margin-bottom: 16px;">
                <div id="shipTypeDetails" style="font-size: 13px; color: var(--text-sub);">
                    <!-- 驕ｸ謚槭＆繧後◆闊ｹ遞ｮ縺ｮ隧ｳ邏ｰ縺後％縺薙↓陦ｨ遉ｺ縺輔ｌ繧・-->
                </div>
            </div>
            <div style="display: flex; gap: 10px;">
                <button id="btnConfirmCreateShip" style="flex: 1; background: var(--accent-color); color: white; padding: 12px; border-radius: 4px; border: none; cursor: pointer;">蟒ｺ騾縺吶ｋ</button>
                <button onclick="document.getElementById('shipCreateModal').style.display='none'" style="flex: 1; background: #4b5563; color: white; padding: 12px; border-radius: 4px; border: none; cursor: pointer;">繧ｭ繝｣繝ｳ繧ｻ繝ｫ</button>
            </div>
        </div>
    </div>

    <!-- 闊ｹ隧ｳ邏ｰ繝｢繝ｼ繝繝ｫ -->
    <div id="shipDetailsModal" class="modal-overlay">
        <div class="modal-content" style="max-height: 80vh; overflow-y: auto;">
            <h2>闊ｹ縺ｮ隧ｳ邏ｰ</h2>
            <div id="shipDetailsContent" style="margin: 20px 0;">
                <!-- 闊ｹ縺ｮ隧ｳ邏ｰ諠・ｱ縺後％縺薙↓陦ｨ遉ｺ縺輔ｌ繧・-->
            </div>
            <button onclick="document.getElementById('shipDetailsModal').style.display='none'" style="width: 100%; background: #4b5563; color: white; padding: 12px; border-radius: 4px; border: none; cursor: pointer;">髢峨§繧・/button>
        </div>
    </div>

    <!-- Scripts -->
    <script src="battle-client.js"></script>
    <script type="module" src="main.js"></script>
</body>
</html>
